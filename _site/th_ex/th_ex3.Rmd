---
title: "Take-home Exercise 3"
description: |
  Interactivity in Visual Analytics
author:
  - name: Antonius Handy 
    url: https://www.linkedin.com/in/antoniushandy
    affiliation: Singapore Management University, Master of IT in Business
    affiliation_url: https://scis.smu.edu.sg/master-it-business
date: "`r Sys.Date()`"
output: 
  distill::distill_article:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

# 1. Overview

In this take-home exercise 3, we are going to reveal the **economic** of the city of Engagement, Ohio USA by using appropriate static and interactive statistical graphics methods. We will show how the financial health of the residents changes over the period of time and how the wages are compared against overall cost of living.

The data is processed by using appropriate tidyverse family of packages, whereas the statistical graphics are prepared using ggplot2 and its extensions.

# 2. Getting Started

Before we get started, it is important for us to ensure that the required R packages have been installed. If yes, we will load the R packages. If they have yet to be installed, we will install the R packages and load them onto R environment.

The packages required for this exercise are [**tidyverse**](https://www.tidyverse.org/), [**ggiraph**](https://davidgohel.github.io/ggiraph/), [**plotly**](https://plotly.com/r/) and [**gganimate**](https://gganimate.com/),
[**zoo**](https://cran.r-project.org/web/packages/zoo/zoo.pdf) and [**trelliscopejs**](https://hafen.github.io/trelliscopejs/index.html.

```{r}
packages = c('tidyverse','ggiraph','plotly','gganimate','zoo','trelliscopejs')

for(p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p, character.only = T)
}
```

# 3. Data

### 3.1 Data Source
The original dataset was obtained from [*VAST Challenge 2022*](https://vast-challenge.github.io/2022/index.html) in csv format. It shows the financial report of the residents of Engagement, OH that have agreed to participate in this study from March 2022 until May 2023.

### 3.2 Importing Data
The code chunk below imports a dataset called *FinancialJournal.csv* into R by using `read_csv()` of **readr** and saves it as tibble data frame called *financial*. It consists of 1,856,330 records as shown below.

```{r}
financial <- read_csv("data/FinancialJournal.csv")
head(financial)
```

### 3.3 Data Wrangling

As we are not interested in time, we will only pick up the month and year by using `as.yearmon()` of **zoo**. 

The financial amounts are allocated into 6 categories namely Education, Food, Recreation, Rent Adjustment, Shelter and Wage. We are going to sum them up and group them by participant ID, yearmonth and category. 

```{r}
financial <- financial %>%
  mutate(yearmonth = as.yearmon(timestamp)) %>%
  group_by(participantId, yearmonth, category) %>%
  summarise(Total = sum(amount))
head(financial)
```

In this code chunk below, we are going to create a new table called *expenses* to reveal the living cost of the residents by excluding Wage and Rent Adjustment from category column.

```{r}
expenses <- financial %>%
  filter(category != 'Wage') %>%
  filter(category != 'RentAdjustment')
```

Next, we are going to use `pivot_wider()` of **dplyr** to create new columns based on the amount of each category, and rename the new table as *fin_wide*.

We will also strip all NA values by specifying `na.rm = TRUE` and calculate the living cost and revenue as follows.

**Living cost = Education + Food + Recreation + Shelter**

**Revenue = Wage + Rent Adjustment**

```{r}
fin_wide <- financial %>%
  pivot_wider(names_from = "category",
              values_from = "Total") %>%
  rowwise() %>%
  mutate(LivingCost = sum(c_across(c(1:4)),na.rm=T)) %>%
  mutate(Revenue = sum(c_across(c(5:6)),na.rm=T))
head(fin_wide)
```

Total savings will be computed as revenue minus living cost. We will rename the new table as *fin_summary* and the new column as *Savings*.

```{r}
fin_summary <- financial %>%
  group_by(participantId, yearmonth) %>%
  summarise(Savings = sum(Total))
head(fin_summary)
```

# 4. Economic Visualisation

## Financial Health of Residents from March 2022 to May 2023 

```{r}
qplot(yearmonth, Savings, data = fin_summary) +
  labs(x = "Year & Month",
       y = "Savings") +
  theme_bw() +
  facet_trelliscope(~ participantId,
                    nrow = 2, ncol = 5,
                    width = 450,
                    path = "trellis/",
                    self_contained = TRUE)
```



## Average Monthly Expenses

On average, residents allocate most of their monthly savings for shelter.

```{r}
p <- ggplot(data = expenses,
       aes(x = category, y = Total*-1))+
  geom_boxplot() +
  xlab("Category") +
  ylab("Amount ($)") +
  ggtitle("Average Monthly Expenses for Each Resident")
ggplotly(p)
```

# 5. References

https://www.statology.org/sum-by-group-in-r/

https://dcl-wrangle.stanford.edu/pivot-advanced.html#wider-1
